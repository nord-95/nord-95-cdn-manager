name: Test and Build

on:
  push:
    branches: [ main, develop ]
  pull_request:
    branches: [ main ]

jobs:
  test:
    runs-on: ubuntu-latest

    steps:
    - uses: actions/checkout@v4
    
    - name: Setup Node.js
      uses: actions/setup-node@v4
      with:
        node-version: '18'
        cache: 'npm'
    
    - name: Install dependencies
      run: npm install
    
    - name: Run linter
      run: npm run lint
    
    - name: Build application
      run: npm run build
      env:
        # Use dummy values for build
        NEXT_PUBLIC_FIREBASE_API_KEY: dummy
        NEXT_PUBLIC_FIREBASE_AUTH_DOMAIN: dummy
        NEXT_PUBLIC_FIREBASE_PROJECT_ID: dummy
        NEXT_PUBLIC_FIREBASE_STORAGE_BUCKET: dummy
        NEXT_PUBLIC_FIREBASE_APP_ID: dummy
        NEXT_PUBLIC_FIREBASE_MESSAGING_SENDER_ID: dummy
        FIREBASE_PROJECT_ID: dummy
        FIREBASE_CLIENT_EMAIL: dummy
        FIREBASE_PRIVATE_KEY: dummy
        R2_ACCOUNT_ID: dummy
        R2_ACCOUNT_HOS: dummy
        R2_ACCESS_KEY_ID: dummy
        R2_SECRET_ACCESS_KEY: dummy
        SUPERADMIN_ALLOWED_DOMAINS: dummy
